<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/thomas-lowry/figma-plugin-ds/dist/figma-plugin-ds.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap"
  rel="stylesheet">

<style>
  body {
    font-family: 'DM Sans', sans-serif;
    padding: 2rem;
  }

  .input__label {
    padding: 0 0.5rem;
  }

  .input__field {
    border: 1px solid var(--black1);
    flex-grow: 1;
    margin-right: 8px;
  }

  .input__container {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 0.25rem;
    margin-bottom: 1rem;
  }

  .input__group {
    display: flex;
    flex-direction: row;
    align-items: stretch;
    flex-grow: 1;
  }

  .input-button-group {
    display: flex;
    align-items: stretch;
  }

  .input-label {
    padding: 0px 12px;
  }

  .class-actions {
    display: flex;
    justify-content: space-between;
    gap: 1rem;
  }
</style>


<div id="app">
  <h1>Class Action</h1>
  <div class="input__container">
    <label class="input__label" for="className">Class Name</label>
    <div class="input__group">
      <input class="input__field" type="text" id="className" name="className">
      <button class="button button--primary" onclick="saveClass()">Save Class</button>
    </div>
  </div>

  <hr>
  <h2>Saved Classes</h2>
  <div id="classList"></div>
</div>

<script>
  function saveClass() {
    const className = document.getElementById('className').value.trim();
    if (className === '') {
      window.parent.postMessage({ pluginMessage: { type: 'empty-class-name' } }, '*');
    } else {
      window.parent.postMessage({ pluginMessage: { type: 'save-class', className } }, '*');
    }
  }

  function deleteClass(className) {
    window.parent.postMessage({ pluginMessage: { type: 'delete-class', className } }, '*');
  }

  function applyClass(className) {
    window.parent.postMessage({ pluginMessage: { type: 'apply-class', className } }, '*');
  }

  function startEditingClassName(oldName) {
    const classDiv = document.getElementById(`classDiv-${oldName}`);
    classDiv.querySelector('.class-name').style.display = 'none';
    classDiv.querySelector('.class-name-input').style.display = 'inline';
    classDiv.querySelector('.class-name-input').focus();
    classDiv.querySelector('.rename-btn').style.display = 'none';
    classDiv.querySelector('.save-btn').style.display = 'inline';
    classDiv.querySelector('.cancel-btn').style.display = 'inline';
  }

  function cancelEditingClassName(oldName) {
    const classDiv = document.getElementById(`classDiv-${oldName}`);
    classDiv.querySelector('.class-name').style.display = 'inline';
    classDiv.querySelector('.class-name-input').style.display = 'none';
    classDiv.querySelector('.rename-btn').style.display = 'inline';
    classDiv.querySelector('.save-btn').style.display = 'none';
    classDiv.querySelector('.cancel-btn').style.display = 'none';
  }

  function saveEditedClassName(oldName) {
    const classDiv = document.getElementById(`classDiv-${oldName}`);
    const newName = classDiv.querySelector('.class-name-input').value.trim();
    if (newName === '') {
      window.parent.postMessage({ pluginMessage: { type: 'empty-class-name' } }, '*');
    } else {
      window.parent.postMessage({ pluginMessage: { type: 'rename-class', className: oldName, newClassName: newName } }, '*');
    }
  }

  function renameClass(oldName) {
    startEditingClassName(oldName);
  }

  onmessage = (event) => {
    const { type, savedClasses } = event.data.pluginMessage;
    const classList = document.getElementById('classList');
    classList.innerHTML = '';

    if (type === 'display-saved-classes') {
      for (const className in savedClasses) {
        const classDiv = document.createElement('div');
        classDiv.id = `classDiv-${className}`;
        classDiv.innerHTML = `
                  <div class="class-actions">
                      <span class="class-name">${className}</span>
                      <input class="class-name-input" type="text" value="${className}" style="display:none;" />
                            <div>
                                <button class="button button--primary" onclick="applyClass('${className}')">Apply</button>
                                <button class="button button--secondary rename-btn" onclick="renameClass('${className}')">Rename</button>
                                <button class="button button--secondary" onclick="deleteClass('${className}')">Delete</button>
                                <button class="button button--secondary save-btn" onclick="saveEditedClassName('${className}')" style="display:none;">Save</button>
                                <button class="button button--secondary cancel-btn" onclick="cancelEditingClassName('${className}')" style="display:none;">Cancel</button>
                            </div>
                        </div>
                    `;
        classList.appendChild(classDiv);
      }
    }
  };
</script>