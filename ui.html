<link rel="stylesheet" href="../node_modules/figma-plugin-ds/dist/figma-plugin-ds.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap"
  rel="stylesheet">

<style>
  body {
    font-family: 'DM Sans', sans-serif;
    padding: 2rem;
  }

  .input__field {
    font-size: 14px;
    padding: 10px 12px;
    background-color: #f0f0f0;
    border: 1px solid #ccc;
    border-radius: 4px;
    width: 100%;
    box-sizing: border-box;
    transition: all 0.3s ease;
    outline: none;
    flex: 1;
    margin-right: 8px;
  }

  .input__field:focus {
    background-color: #fff;
    border-color: #18a0fb;
  }

  .input-container {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    margin-bottom: 1rem;
  }

  .input-button-group {
    display: flex;
    align-items: stretch;
  }

  .input-label {
    padding: 0px 12px;
  }

  .save-class-btn {
    padding: 10px 12px;
    background-color: #18a0fb;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.3s ease;
  }

  .save-class-btn:hover {
    background-color: #3b79c9;
  }

  .save-class-btn:focus {
    outline: none;
  }

  .class-actions {
    display: flex;
    justify-content: space-between;
  }
</style>

<h1>Class Action</h1>

<!-- <div class="switch">
  <input class="switch__toggle" type="checkbox" id="dark-mode-on">
  <label class="switch__label" for="dark-mode-on">Dark Mode</label>
</div> -->

<div class="input-container">
  <label class="input-label" for="classNameInput">Class name</label>
  <div class="input-button-group">
    <input class="input__field" type="text" id="classNameInput" placeholder="Choose Class name" />
    <button class="save-class-btn" onclick="saveClass()">Save class</button>
  </div>
</div>

<div id="classList"></div>

<script src="../node_modules/figma-plugin-ds/dist/figma-plugin-ds.min.js"></script>

<script>

  function saveClass() {
    const className = document.getElementById('classNameInput').value;
    window.parent.postMessage({ pluginMessage: { type: 'save-class', className } }, '*');
  }

  function deleteClass(className) {
    window.parent.postMessage({ pluginMessage: { type: 'delete-class', className } }, '*');
  }


  function renameClass(oldName) {
    const newName = prompt('Enter new class name:', oldName);
    if (newName === null) {
      // User clicked "Cancel", do nothing
      return;
    } else if (newName.trim() === '') {
      window.parent.postMessage({ pluginMessage: { type: 'empty-class-name' } }, '*');
    } else {
      // Send the keys as oldName and newName
      window.parent.postMessage({ pluginMessage: { type: 'rename-class', oldName: oldName, newName: newName } }, '*');
    }
  }

  function applyClass(className) {
    window.parent.postMessage({ pluginMessage: { type: 'apply-class', className } }, '*');
  }

  onmessage = (event) => {
    if (event.data.pluginMessage.type === 'display-saved-classes') {
      const savedClasses = event.data.pluginMessage.savedClasses;
      const classList = document.getElementById('classList');
      classList.innerHTML = '';

      for (const className in savedClasses) {
        const classDiv = document.createElement('div');
        classDiv.innerHTML = `
              <div class="class-actions">
                <span>${className}</span>
                <div>
                  <button class="button button--primary" onclick="applyClass('${className}')">Apply</button>
                  <button class="button button--secondary" onclick="renameClass('${className}')">Rename</button>
                  <button class="button button--secondary" onclick="deleteClass('${className}')">Delete</button>
                </div>
              </div>
            `;
        classList.appendChild(classDiv);
      }
    }
  };
</script>