<!DOCTYPE html>
<html lang="en">

<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Lemon Squeezy API Test</title>
        <style>
                body {
                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
                        max-width: 800px;
                        margin: 0 auto;
                        padding: 20px;
                        line-height: 1.6;
                }

                button {
                        background-color: #4CAF50;
                        border: none;
                        color: white;
                        padding: 10px 20px;
                        text-align: center;
                        text-decoration: none;
                        display: inline-block;
                        font-size: 16px;
                        margin: 4px 2px;
                        cursor: pointer;
                        border-radius: 4px;
                }

                input,
                textarea {
                        width: 100%;
                        padding: 12px;
                        border: 1px solid #ccc;
                        border-radius: 4px;
                        box-sizing: border-box;
                        margin-top: 6px;
                        margin-bottom: 16px;
                        resize: vertical;
                }

                pre {
                        background-color: #f5f5f5;
                        padding: 15px;
                        border-radius: 4px;
                        overflow-x: auto;
                }

                .error {
                        color: red;
                }

                .success {
                        color: green;
                }
        </style>
</head>

<body>
        <h1>Lemon Squeezy API Test</h1>

        <div>
                <h2>API Configuration</h2>
                <div>
                        <label for="apiKey">API Key:</label>
                        <input type="text" id="apiKey" placeholder="Enter your Lemon Squeezy API key">
                </div>
                <div>
                        <label for="storeId">Store ID:</label>
                        <input type="text" id="storeId" value="155794">
                </div>
                <div>
                        <label for="productId">Product ID:</label>
                        <input type="text" id="productId" value="453124">
                </div>
        </div>

        <div>
                <h2>License Validation</h2>
                <div>
                        <label for="licenseKey">License Key:</label>
                        <input type="text" id="licenseKey" value="F2AF6EB5-A0E3-4C05-95B2-CC23766511E0">
                </div>
                <div>
                        <label for="instanceId">Instance ID:</label>
                        <input type="text" id="instanceId" value="test-device">
                </div>
                <button id="validateBtn">Validate License</button>
        </div>

        <div>
                <h2>Results</h2>
                <pre id="results">Results will appear here...</pre>
        </div>

        <script>
                document.getElementById('validateBtn').addEventListener('click', async () => {
                        const apiKey = document.getElementById('apiKey').value;
                        const storeId = document.getElementById('storeId').value;
                        const productId = document.getElementById('productId').value;
                        const licenseKey = document.getElementById('licenseKey').value;
                        const instanceId = document.getElementById('instanceId').value;

                        if (!apiKey) {
                                displayResult('Please enter an API key', true);
                                return;
                        }

                        const resultsElement = document.getElementById('results');
                        resultsElement.textContent = 'Testing connection...';

                        try {
                                // First try a simple connection test
                                displayResult('Testing basic connection to Lemon Squeezy API...', false);

                                try {
                                        const connectionResponse = await fetch('https://api.lemonsqueezy.com/v1', {
                                                method: 'GET',
                                                headers: {
                                                        'Accept': 'application/json'
                                                }
                                        });

                                        displayResult(`Connection test response: ${connectionResponse.status} ${connectionResponse.statusText}`, false);

                                        if (connectionResponse.status === 401) {
                                                displayResult('Basic connection successful (401 is expected without auth)', false);
                                        } else {
                                                displayResult(`Unexpected status code: ${connectionResponse.status}`, true);
                                        }
                                } catch (connectionError) {
                                        displayResult(`Connection test failed: ${connectionError.message}`, true);
                                }

                                // Now try the actual validation
                                displayResult('Attempting license validation...', false);

                                const payload = {
                                        license_key: licenseKey,
                                        instance_identifier: instanceId,
                                        store_id: storeId,
                                        product_id: productId
                                };

                                const response = await fetch('https://api.lemonsqueezy.com/v1/licenses/validate', {
                                        method: 'POST',
                                        headers: {
                                                'Content-Type': 'application/json',
                                                'Accept': 'application/json',
                                                'Authorization': `Bearer ${apiKey}`
                                        },
                                        body: JSON.stringify(payload)
                                });

                                const data = await response.json();

                                if (response.ok) {
                                        displayResult('Validation successful!', false);
                                        displayResult(JSON.stringify(data, null, 2), false);
                                } else {
                                        displayResult(`Validation failed with status: ${response.status}`, true);
                                        displayResult(JSON.stringify(data, null, 2), true);
                                }
                        } catch (error) {
                                displayResult(`Error: ${error.message}`, true);
                                console.error('Full error:', error);
                        }
                });

                function displayResult(message, isError) {
                        const resultsElement = document.getElementById('results');
                        const currentContent = resultsElement.textContent;

                        if (currentContent === 'Results will appear here...') {
                                resultsElement.textContent = message;
                        } else {
                                resultsElement.textContent = `${currentContent}\n\n${message}`;
                        }

                        if (isError) {
                                resultsElement.classList.add('error');
                                resultsElement.classList.remove('success');
                        } else {
                                resultsElement.classList.add('success');
                                resultsElement.classList.remove('error');
                        }
                }
        </script>
</body>

</html>